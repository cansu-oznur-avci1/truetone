{% extends "base.html" %}

{% block title %}Service Management Intelligence{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<div class="container py-5">
    <div class="row mb-5 animate__animated animate__fadeIn">
        <div class="col-lg-12">
            <div class="main-banner p-5 rounded-5 border-0 shadow-lg text-white position-relative overflow-hidden">
                <div class="position-relative z-index-2 text-start">
                    <h1 class="display-5 fw-bold mb-2">Service Owner Dashboard</h1>
                    <p class="lead opacity-75">Live monitoring & AI-optimized feedback analytics.</p>
                </div>
                <div class="banner-circle"></div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm rounded-4 stat-card-premium bg-white p-4">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="text-start">
                        <h6 class="text-muted small fw-bold text-uppercase mb-2">Total Feedbacks</h6>
                        <h2 class="fw-black text-dark mb-0">{{ feedbacks|length }}</h2>
                    </div>
                    <div class="icon-wrap bg-primary-subtle text-primary"><i class="fas fa-comments"></i></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm rounded-4 stat-card-premium bg-white p-4">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="text-start">
                        <h6 class="text-muted small fw-bold text-uppercase mb-2">AI Normalization</h6>
                        <h2 class="fw-black text-success mb-0 pulse-text">ACTIVE</h2>
                    </div>
                    <div class="icon-wrap bg-success-subtle text-success"><i class="fas fa-robot"></i></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm rounded-4 stat-card-premium bg-white p-4">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="text-start">
                        <h6 class="text-muted small fw-bold text-uppercase mb-2">Data Privacy</h6>
                        <h2 class="fw-black text-info mb-0">ENABLED</h2>
                    </div>
                    <div class="icon-wrap bg-info-subtle text-info"><i class="fas fa-user-shield"></i></div>
                </div>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-lg rounded-5 overflow-hidden animate__animated animate__slideInUp">
        <div class="card-header bg-white py-4 px-4 d-flex justify-content-between align-items-center border-0">
            <h4 class="mb-0 fw-bold text-dark"><i class="fas fa-stream me-2 text-primary"></i>Recent Submissions</h4>
            <span class="badge bg-soft-primary text-primary rounded-pill px-3 py-2"><i class="fas fa-sync fa-spin me-2"></i>Live Data</span>
        </div>
        
        <div class="table-responsive">
            <table class="table table-borderless align-middle mb-0">
                <thead>
                    <tr class="bg-light-subtle border-bottom">
                        <th class="ps-5 py-4 text-muted small fw-bold text-uppercase text-start">Service</th>
                        <th class="py-4 text-muted small fw-bold text-uppercase text-center">Severity</th>
                        <th class="py-4 text-muted small fw-bold text-uppercase text-start" style="width: 45%;">AI Optimized Content</th>
                        <th class="pe-5 py-4 text-muted small fw-bold text-uppercase text-end">Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for fb in feedbacks %}
                    <tr class="hover-row-glow transition-all">
                        <td class="ps-5 text-start">
                            <div class="d-flex align-items-center">
                                <div class="avatar-icon bg-dark text-white rounded-3 me-3">{{ fb.service.name|slice:":1" }}</div>
                                <div>
                                    <div class="fw-bold text-dark">{{ fb.service.name }}</div>
                                    <small class="text-primary fw-bold" style="font-size: 0.65rem;">{{ fb.category|upper }}</small>
                                </div>
                            </div>
                        </td>
                        <td class="text-center">
                            <span class="badge rounded-pill px-3 py-2 
                                {% if fb.severity >= 4 %} bg-danger 
                                {% elif fb.severity == 3 %} bg-warning text-dark 
                                {% elif fb.severity == 2 %} bg-info-custom text-white 
                                {% else %} bg-success {% endif %}">
                                Level {{ fb.severity }}
                            </span>
                        </td>
                        <td class="text-start">
                            <div class="p-3 rounded-4 bg-light border-0 ai-bubble shadow-sm">
                                <p class="mb-0 text-secondary small italic">
                                    <i class="fas fa-magic me-2 text-primary opacity-50"></i>{{ fb.normalized_text|default:"Awaiting analysis..." }}
                                </p>
                            </div>
                        </td>
                        <td class="pe-5 text-end text-start">
                            <div class="fw-bold text-dark small">{{ fb.date|date:"M d, Y" }}</div>
                            <div class="text-muted" style="font-size: 0.7rem;">{{ fb.date|date:"H:i A" }}</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
    body { background-color: #f3f4f6; font-family: 'Plus Jakarta Sans', sans-serif; }
    .main-banner { background: linear-gradient(135deg, #0f172a 0%, #2563eb 100%); }
    .banner-circle { position: absolute; top: -50px; right: -50px; width: 250px; height: 250px; background: rgba(255,255,255,0.1); border-radius: 50%; }
    .stat-card-premium:hover { transform: translateY(-8px); border-color: #3b82f6; }
    .icon-wrap { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 15px; font-size: 1.25rem; }
    .bg-info-custom { background-color: #0ea5e9 !important; box-shadow: 0 2px 4px rgba(14, 165, 233, 0.2); }
    .hover-row-glow:hover { background-color: #ffffff !important; transform: scale(1.005); }
    .pulse-text { animation: pulse-opacity 2s infinite; }
    @keyframes pulse-opacity { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    .fw-black { font-weight: 800; }
    .bg-light-subtle { background-color: #f9fafb; }
</style>
{% endblock %}