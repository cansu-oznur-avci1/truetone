{% extends "base.html" %}

{% block title %}My Feedback History | TrueTone{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row mb-5">
        <div class="col-lg-8 mx-auto text-center">
            <h1 class="display-5 fw-bold text-dark mb-3">Feedback History</h1>
            <p class="lead text-muted">View and monitor the status of your submitted feedback in real-time.</p>
            <div class="d-flex justify-content-center gap-3 mt-4">
                <a href="{% url 'services:service_list' %}" class="btn btn-primary btn-lg px-5 rounded-pill shadow-sm">
                    <i class="fas fa-plus me-2"></i>New Submission
                </a>
            </div>
        </div>
    </div>

    <div class="row mb-5 g-4 text-center">
        <div class="col-md-4">
            <div class="p-4 bg-white rounded-4 shadow-sm border-0">
                <div class="text-primary mb-2"><i class="fas fa-paper-plane fa-2x"></i></div>
                <h3 class="fw-bold mb-0">{{ feedbacks|length }}</h3>
                <small class="text-uppercase text-muted fw-semibold">Total Sent</small>
            </div>
        </div>
        <div class="col-md-4">
            <div class="p-4 bg-white rounded-4 shadow-sm border-0">
                <div class="text-success mb-2"><i class="fas fa-check-double fa-2x"></i></div>
                <h3 class="fw-bold mb-0">{% if feedbacks %}{{ feedbacks|length }}{% else %}0{% endif %}</h3>
                <small class="text-uppercase text-muted fw-semibold">Processed</small>
            </div>
        </div>
        <div class="col-md-4">
            <div class="p-4 bg-white rounded-4 shadow-sm border-0">
                <div class="text-info mb-2"><i class="fas fa-robot fa-2x"></i></div>
                <h3 class="fw-bold mb-0">{% if feedbacks %}AI Enabled{% else %}Active{% endif %}</h3>
                <small class="text-uppercase text-muted fw-semibold">Security Engine</small>
            </div>
        </div>
    </div>

    <div class="row">
        {% for fb in feedbacks %}
        <div class="col-lg-12 mb-4">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden feedback-card">
                <div class="row g-0">
                    <div class="col-md-3 bg-light d-flex flex-column justify-content-center align-items-center border-end p-4 text-center">
                        <div class="badge rounded-pill mb-3 {% if fb.severity == 4 %}bg-danger{% elif fb.severity == 3 %}bg-warning text-dark{% else %}bg-info text-dark{% endif %} px-3 py-2">
                            {% if fb.severity == 4 %}CRITICAL{% elif fb.severity == 3 %}HIGH{% else %}MEDIUM{% endif %}
                        </div>
                        <h5 class="fw-bold text-dark mb-1">{{ fb.service.name }}</h5>
                        <small class="text-muted"><i class="far fa-calendar-alt me-2"></i>{{ fb.date|date:"M d, Y" }}</small>
                    </div>
                    <div class="col-md-9 px-4 py-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <span class="badge bg-light text-primary border border-primary-subtle me-2">{{ fb.category|upper }}</span>
                                <span class="badge bg-light text-secondary border border-secondary-subtle">{{ fb.tone|upper }}</span>
                            </div>
                            {% if fb.normalized_text %}
                                <span class="text-success fw-bold small"><i class="fas fa-magic me-1"></i> AI ENHANCED</span>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="text-muted small fw-bold text-uppercase mb-2">Original Content:</h6>
                            <p class="text-dark bg-light-subtle p-3 rounded-3 border-start border-4 border-primary shadow-inner">
                                "{{ fb.raw_text }}"
                            </p>
                        </div>

                        <div class="d-flex justify-content-end">
                            <a href="#" class="btn btn-link text-decoration-none fw-bold p-0">View Details <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-lg-8 mx-auto text-center py-5">
            <div class="p-5 bg-white rounded-5 shadow-sm border border-2 border-dashed">
                <img src="https://cdn-icons-png.flaticon.com/512/7486/7486744.png" alt="No data" class="mb-4" style="width: 120px; opacity: 0.5;">
                <h3 class="fw-bold">No feedback yet!</h3>
                <p class="text-muted mb-4">Your history is empty. Start by sharing your first feedback to help us grow.</p>
                <a href="{% url 'services:service_list' %}" class="btn btn-primary px-5 py-3 rounded-pill fw-bold">Let's Get Started</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    body { background-color: #f8f9fa; }
    .feedback-card { transition: all 0.3s ease; }
    .feedback-card:hover { transform: scale(1.01); box-shadow: 0 10px 30px rgba(0,0,0,0.08) !important; }
    .rounded-4 { border-radius: 1.25rem !important; }
    .rounded-5 { border-radius: 2rem !important; }
    .bg-light-subtle { background-color: #f1f3f5; }
    .shadow-inner { box-shadow: inset 0 2px 4px rgba(0,0,0,0.03); }
</style>
{% endblock %}